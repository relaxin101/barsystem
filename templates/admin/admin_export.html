{% extends "base.html" %}
{% block scripts %}
  <!-- PrismJS CSS & JS nur fÃ¼r diese Seite -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>

  <script>
    // Highlighten, falls dynamisch Inhalte nachladen
    Prism.highlightAll();
  </script>
{% endblock %}
{% block content %}
<div class="container-fluid mt-4">
  <h2 class="mb-4">ðŸ“Š Bericht-Verwaltung</h2>

  <div class="row">
    <div class="col-12">
  <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <strong>Gespeicherte Berichte</strong>
        </div>

  <div class="row row-cols-auto m-4">
	{% for bericht in berichte %}
	    <div class="mb-4 col">
		  
		  <a href="{{ url_for('admin.admin_export', id=bericht.id) }}" class="btn btn-success">
			  <i class="bi bi-clipboard"></i> {{bericht.name}}
		  </a>
	    </div>
	{% endfor %}

  </div>
  </div>
  </div>
  </div>

  <!-- Eigene SQL-Query -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <strong>Eigene SQL-Query</strong>
        </div>
        <div class="card-body">
          {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
          {% endif %}

          <form method="post" action="{{ url_for('admin.admin_export') }}" class="mb-3">

<label for="query" class="form-label">SQL Query</label>
<textarea class="form-control mb-2" id="query" name="query" rows="5">{{ query }}</textarea>

{% if query %}
<pre><code class="language-sql">{{ query }}</code></pre>
{% endif %}

            <div class="mt-2">
              <button type="submit" class="btn btn-primary me-2">AusfÃ¼hren</button>
              {% if results %}
                <button formaction="{{ url_for('admin.sql_export_download') }}" formmethod="post" class="btn btn-success">
                  <i class="bi bi-download"></i> Excel herunterladen
                </button>
              {% endif %}

              {% if not id %}
		    <div class="col-md-3">
		      <label for="name" class="form-label">Bericht-Name</label>
		      <input type="text" class="form-control" id="name" name="name" ">
		    </div>
		
                <button formaction="{{ url_for('admin.create_berichte') }}" formmethod="POST" class="btn btn-success">
                  <i class="bi bi-bookmark"></i> Bericht speichern
                </button>
              {% endif %}
            </div>
          </form>
          {% if id %}
		<form method="post" action="{{ url_for('admin.delete_berichte', bericht_id=id) }}">
		  <input type="hidden" name="_method" value="DELETE">
		  <button type="submit" class="btn btn-danger">
		    <i class="bi bi-bookmark-fill"></i> Bericht lÃ¶schen
		  </button>
		</form>
          {% endif %}

          {% if results %}
		<div class="table-responsive" style="max-height:400px; overflow:auto;">
		  <table class="table table-striped table-hover table-bordered align-middle">
		    <thead class="table-dark">
		      <tr>
			{% for col in results[0].keys() %}
			  <th>{{ col }}</th>
			{% endfor %}
		      </tr>
		    </thead>
		    <tbody>
		      {% for row in results %}
			<tr>
			  {% for val in row.values() %}
			    <td>{{ val }}</td>
			  {% endfor %}
			</tr>
		      {% endfor %}
		    </tbody>
		  </table>
		</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
